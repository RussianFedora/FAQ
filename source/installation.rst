..
    Fedora-Faq-Ru (c) 2018 - 2020, EasyCoding Team and contributors

    Fedora-Faq-Ru is licensed under a
    Creative Commons Attribution-ShareAlike 4.0 International License.

    You should have received a copy of the license along with this
    work. If not, see <https://creativecommons.org/licenses/by-sa/4.0/>.

.. _installation:

*****************
Установка системы
*****************

.. index:: flash, usb, live, installation
.. _usb-flash:

Как мне создать загрузочную флешку?
==========================================

См. `здесь <https://www.easycoding.org/2017/07/12/sozdayom-fedora-liveusb.html>`__.

.. index:: live, image to ram, ram
.. _live-to-ram:

Как загрузить Live образ целиком в память?
==============================================

Для загрузки :ref:`Live образа <usb-flash>` целиком в память, необходимо стрелками выбрать пункт **Start Fedora Live**, нажать **Tab**, затем в строке редактирования параметров добавить ``rd.live.ram`` через пробел сразу после ``quiet`` и после этого нажать **Enter**.

.. index:: package, selection
.. _package-selection:

Есть возможность самому выбрать пакеты для установки?
==========================================================

Да, при помощи netinstall образа, но лишь :ref:`группами <dnf-groups>`.

.. index:: installation, network, internet
.. _web-install:

Необходим ли доступ в Интернет при установке?
==========================================================

Только для netinstall образа. Все остальные устанавливаются «как есть», т.е. со стандартным набором пакетов.

.. index:: installation, automatic
.. _automatic-install:

Могу ли я автоматизировать установку?
==========================================================

Да, посредством `Kickstart <https://pykickstart.readthedocs.io/en/latest/>`__.

.. index:: iso, image, custom
.. _custom-iso:

Могу ли я создать свой собственный ISO образ?
==========================================================

Да. Собственный образ можно создать на базе Kickstart файлов. Более подобную информацию можно найти `здесь <https://fedoraproject.org/wiki/Livemedia-creator-_How_to_create_and_use_a_Live_CD>`__.

Готовые Kickstart проекты для изучения:

  * `Fedora <https://pagure.io/fedora-kickstarts>`__;
  * `RFRemix <https://github.com/RussianFedora/rfremix-kickstarts>`__.

.. index:: installation, arm, armhfp, armv7hl, aarch64, arm64
.. _fedora-arm:

Можно ли установить Fedora на устройство с ARM?
==========================================================

Да. Загрузки доступны для `armhfp <https://arm.fedoraproject.org/>`__, а также `aarch64 <https://alt.fedoraproject.org/alt/>`__.

.. index:: boot, secure boot
.. _secure-boot:

Поддерживается ли технология Secure Boot?
==========================================================

Да, полностью. В качестве предварительного загрузчика используется **shim**, подписанный цифровой подписью Microsoft.

.. index:: moving installed system, move
.. _moving-system:

Могу я переместить Fedora на другой диск?
============================================

Да. Алгоритм такой:

  1. загрузка с :ref:`Fedora LiveUSB <usb-flash>`;
  2. :ref:`создание разделов <fedora-partitions>` для новой установки Fedora посредством GParted или любой другой утилиты разбиения дисков;
  3. монтирование старых и новых разделов;
  4. :ref:`копирование всех файлов и каталогов <copying-data>` со старого накопителя на новый с сохранением прав доступа;
  5. редактирование файла ``/etc/fstab`` нового накопителя так, чтобы в нём были указаны :ref:`UUID <get-uuid>` новых разделов;
  6. создание в корневом каталоге нового накопителя файла ``/.autorelabel`` для автоматической установки :ref:`контекста безопасности <selinux-boot-error>` SELinux;
  7. :ref:`установка загрузчика <grub-rebuild>` (если необходимо).

.. index:: swap, page file, zram
.. _swap-info:

У меня много оперативной памяти. Нужен ли мне раздел подкачки?
===================================================================

За счёт использования :ref:`сжатия памяти zram <memory-compression>`, в современных выпусках Fedora для большинства сценариев использования на рабочих станциях 10+ ГБ оперативной памяти будет вполне достаточно, поэтому раздел подкачки можно не создавать.

Внимание! При отсутствии раздела подкачки перестанет работать функция suspend to disk (гибернация).

.. index:: swap, page file
.. _mem-outage:

Что будет если при отсутствующем разделе подкачки закончится память?
========================================================================

При критическом недостатке оперативной памяти (исчерпании доступных страниц) и при отсутствии подкачки существует риск зависания всей системы.

Таким образом, для данной конфигурации настоятельно рекомендуется использовать любой OOM killer пользовательского режима: :ref:`earlyoom <earlyoom-info>`, :ref:`systemd-oomd <oomd-info>` и т.п., чтобы не подвергать систему опасности и не доводить до использования механизма OOM Killer ядра Linux.

.. index:: swap, page file
.. _swap-limits:

Сколько нужно подкачки для работы гибернации?
=================================================

Для нормальной работы режима suspend to disk размер подкачки должен быть больше, либо равен объёму установленной в ПК или ноутбуке оперативной памяти.

.. index:: swap, page file
.. _swap-partitions:

Что быстрее: раздел подкачки или файл подкачки?
===================================================

Раздел подкачки, т.к. отсутствуют ограничения, накладываемые используемой файловой системой.

.. index:: swap, page file
.. _swappiness:

Можно ли сделать так, чтобы подкачка использовалась лишь при исчерпании ОП?
================================================================================

Да, это возможно. Откроем терминал и выполним следующие команды:

.. code-block:: text

    sudo sysctl -w vm.swappiness=0
    sudo sysctl -w vm.watermark_scale_factor=1

Изменения вступят в силу немедленно и сохранятся до перезагрузки системы.

Для того, чтобы сделать эти изменения постоянными, создадим :ref:`файл конфигурации sysctl <sysctl-permanent>`.

.. index:: speed-up, boot
.. _speedup-main:

Как ускорить запуск системы?
================================

Приобрести в компьютер или ноутбук SSD накопитель и установить операционную систему на него. Это даст колоссальный прирост к скорости запуска.

.. index:: speed-up, boot
.. _speedup-home:

Можно ли не переносить на SSD домашние каталоги пользователей?
=================================================================

Можно, но настоятельно не рекомендуется так делать ибо в таком случае прирост скорости работы системы будет далеко не таким большим, каким мог бы быть, т.к. колонна всегда двигается со скоростью самой медленной машины, а это всегда жёсткий диск.

Большая часть приложений хранят в домашних каталогах пользователей свои файлы конфигурации, а также различные кэши. В итоге, они загрузятся быстро, а затем перейдут в состояние iowait для ожидания этих данных с медленного накопителя.

Таким образом, на быстром SSD накопителе следует размещать как корневой, так и домашние каталоги пользователей.

.. index:: ssd, tuning, trim, timer
.. _ssd-tuning:

Нужно ли как-то настраивать Fedora для работы с SSD?
========================================================

Особой настройки не требуется. Необходимо лишь убедиться, что таймер процедуры TRIM активен:

.. code-block:: text

    systemctl status fstrim.timer

Если это не так, активируем его:

.. code-block:: text

    sudo systemctl enable fstrim.timer

Процедура TRIM для всех установленных твердотельных накопителей будет выполняться автоматически по расписанию один раз в неделю во время простоя системы.

.. index:: ssd, tuning, trim, lvm
.. _ssd-trim:

Возможно ли в Fedora включить TRIM в реальном времени?
==========================================================

Да, это возможно. При использовании классической схемы с обычными разделами необходимо добавить опцию монтирования ``discard`` для каждого раздела на SSD в ``/etc/fstab``.

При использовании LVM, следует открыть файл ``/etc/lvm/lvm.conf`` в текстовом редакторе и прописать:

.. code-block:: text

    issue_discards = 1

При использовании зашифрованных LUKS томов следует в файле ``/etc/crypttab`` добавить опцию ``discard`` для каждого тома.

Однако следует помнить, что на некоторых накопителях реалтаймовый TRIM может вызвать сбой в работе контроллера и привести к потере всех данных. Именно поэтому он по умолчанию и не применяется.

Все изменения вступят в силу при следующей загрузке системы.

.. index:: ssd, tuning, trim, timer
.. _ssd-timer:

Почему таймер TRIM отключён по умолчанию?
============================================

Изначально :ref:`таймер TRIM <ssd-tuning>` активировался автоматически, если установка Fedora производилась на SSD накопитель, но через некоторое время обнаружилась серьёзная проблема с noname-накопителями. Их контроллеры делегировали поддержку процедуры TRIM, однако при её выполнении теряли все данные на носителе.

Из-за достаточно большого количества жалоб на потерю данных с таких дешёвых контрафактных noname накопителей, созданных на базе простейших контроллеров от флешек и микросхем памяти из отбраковки, было решено таймер отключить.

.. index:: fonts, anti-aliasing, hinting, cleartype
.. _fonts-cleartype:

Как улучшить отображение шрифтов в Fedora?
=============================================

В актуальных релизах Fedora пакет freetype уже собран с поддержкой субпиксельного сглаживания, поэтому, чтобы получить качественный рендеринг шрифтов, необходимо лишь разрешить использование LCD фильтров, создав символическую ссылку на файл ``11-lcdfilter-default.conf`` в каталоге ``/etc/fonts/conf.d``:

.. code-block:: text

    sudo ln -s /usr/share/fontconfig/conf.avail/11-lcdfilter-default.conf /etc/fonts/conf.d/

Для вступления изменений в силу необходимо повторно войти в систему либо перезагрузить компьютер.

.. index:: console, framebuffer, fonts, cyrillic
.. _fonts-console:

В консолях фреймбуфера отображаются кракозябры. Как это починить?
=====================================================================

**Способ 1:**

Зададим :ref:`параметр ядра <kernelpm-perm>` ``vconsole.font``:

.. code-block:: text

    vconsole.font=latarcyrheb-sun16

:ref:`Пересоберём <grub-rebuild>` конфиг Grub2.

**Способ 2:**

Установим пакет шрифтов Terminus:

.. code-block:: text

    sudo dnf install terminus-fonts-console

Теперь откроем файл ``/etc/vconsole.conf`` в текстовом редакторе:

.. code-block:: text

    sudoedit /etc/vconsole.conf

Укажем правильное имя шрифта внутри директивы ``FONT``:

.. code-block:: text

    FONT=ter-v16n

Сохраним изменения в файле и :ref:`пересоберём <initrd-rebuild>` initrd.

.. index:: file system, selection, fs, ext4, xfs, btrfs
.. _fs-selection:

Какую файловую систему рекомендуется использовать на Fedora?
================================================================

Начиная с Fedora 33, в редакции Workstation, для установки по умолчанию предлагается :ref:`BTRFS <fs-btrfs>`.

Несмотря на это, мы рекомендуем применять `ext4 <https://ru.wikipedia.org/wiki/Ext4>`__. На наш взгляд, это самая стабильная и популярная файловая система в настоящее время.

Для хранения больших объёмов данных можно использовать `XFS <https://ru.wikipedia.org/wiki/XFS>`__. Это также стабильная и быстрая ФС, но следует помнить, что при сбоях электропитания вместо файлов, в которые в этот момент шла запись, могут оказаться нули. Таким образом, XFS лучше применять только если есть источник бесперебойного питания (UPS) либо на ноутбуках.

.. index:: file system, fs, btrfs, selection
.. _fs-btrfs:

Что вы скажете об установке системы на BTRFS?
================================================

Достоинства:

  * поддержка `копирования при записи (COW) <https://ru.wikipedia.org/wiki/%D0%9A%D0%BE%D0%BF%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_%D0%BF%D1%80%D0%B8_%D0%B7%D0%B0%D0%BF%D0%B8%D1%81%D0%B8>`__;
  * поддержка проверки целостности данных посредством контрольных сумм;
  * поддержка `моментальных снимков системы (snapshot) <https://ru.wikipedia.org/wiki/%D0%A1%D0%BD%D0%B8%D0%BC%D0%BE%D0%BA_%D1%84%D0%B0%D0%B9%D0%BB%D0%BE%D0%B2%D0%BE%D0%B9_%D1%81%D0%B8%D1%81%D1%82%D0%B5%D0%BC%D1%8B>`__;
  * отсутствие ограничения на максимальное количество файлов;
  * поддержка прозрачного сжатия данных с использованием нескольких алгоритмов;
  * поддержка подтомов (subvolume);
  * встроенная поддержка клонирования, что полезно при создании резервных копий;
  * :ref:`оффлайновая дедупликация <deduplication-disk>` записываемых данных.

Недостатки:

  * ранее `была слишком нестабильной <https://ru.fedoracommunity.org/posts/budushchee-btrfs/>`__ и при определённых условиях приводила к потере всех данных на накопителе;
  * не имеет встроенного полнодискового шифрования;
  * известны случаи несовместимости с системой внешнего полнодискового шифрования LUKS;
  * из-за COW очень сильно фрагментируется, поэтому не рекомендуется к использованию на жёстких магнитных дисках (HDD);
  * без использования флага ``nodatacow`` проседает производительность баз данных (СУБД), а также виртуальных машин.

.. index:: file system, convert, fs
.. _fs-convert:

Можно ли без потерь данных преобразовать одну файловую систему в другую?
==============================================================================

Нет, конвертирование ФС без потери данных не представляется возможным, поэтому для выполнения данной процедуры необходим другой раздел диска подходящего размера с поддержкой прав доступа Unix. Алгоритм следующий:

  1. копирование всех данных на другой раздел с :ref:`сохранением прав доступа <copying-data>`;
  2. форматирование старого раздела с необходимой файловой системой;
  3. возвращение данных на прежнее место;
  4. :ref:`сброс контекста <selinux-boot-error>` SELinux.

.. index:: uefi, boot, esp
.. _uefi-boot:

Как установить Fedora в UEFI режиме?
=======================================

Загрузка :ref:`Fedora LiveUSB <usb-flash>` образа должна производиться исключительно в UEFI режиме. На большинстве материнских плат в меню вариантов загрузки требуется выбрать режим *UEFI External Drive* или *UEFI USB HDD*.

Схемой разбиения диска, на который будет установлен дистрибутив, должна быть **GPT**. Проверить можно посредством выполнения **fdisk**:

.. code-block:: text

    sudo fdisk -l

Если используется классический **MBR** (**msdos**), необходимо запустить утилиту GParted, выбрать диск из списка, затем в меню **Устройство** пункт **Создать таблицу разделов** -- **GPT** и запустить процесс кнопкой **Применить изменения**. Все данные на диске будут уничтожены.

Теперь можно приступать к установке. Автоматическое разбиение в Anaconda произведёт все действия самостоятельно.

.. index:: drive, partitions, partitioning
.. _lvm-vs-partitions:

Какой способ разбиения диска лучше выбрать?
==============================================

Существует 2 способа:

  1. `LVM <https://ru.wikipedia.org/wiki/LVM>`__ (используется по умолчанию) -- динамические разделы, позволяющие изменять разделы на лету в любую сторону, а также поддерживающие функцию моментальных снимков (снапшотов);
  2. классическая схема с физическими разделами.

Если возможности LVM использовать не планируется на ПК или ноутбуке, то рекомендуется применять :ref:`классическое разбиение <fedora-partitions>`, т.к. такая схема работает быстрее и надёжнее.

.. index:: drive, partitions, partitioning
.. _fedora-partitions:

Как лучше разбить диск самостоятельно?
=========================================

Если по какой-то причине не хочется доверять автоматическому разбиению, мы рекомендуем следующую конфигурацию (порядок важен):

.. csv-table::
    :header: "Порядок", "Файловая система", "Размер раздела", "Точка монтирования", "Описание"
    :widths: 7, 15, 13, 16, 49

    "1", "efi (vfat)", "200 МБ", "/boot/efi", "Служебный ESP (UEFI) раздел."
    "2", "ext4", "1 ГБ", "/boot", "Раздел для хранения ядер и initrd."
    "3", "ext4 или xfs", "20 ГБ", "/", "Корневой раздел для системы и приложений."
    "4", "ext4 или xfs", "всё - swap", "/home", "Раздел для хранения пользовательских файлов."
    "5", "swapfs", "= RAM", "swap", "Раздел подкачки (:ref:`если необходим <swap-info>`)."

Здесь **RAM** -- объём установленной оперативной памяти.

.. index:: grub, boot, menu
.. _grub-hide:

Как полностью скрыть меню Grub?
====================================

Скрытие меню загрузки на UEFI конфигурациях:

.. code-block:: text

    sudo grub2-editenv - set menu_auto_hide=1
    sudo grub2-mkconfig -o /etc/grub2-efi.cfg

Скрытие меню загрузки на legacy конфигурациях:

.. code-block:: text

    sudo grub2-editenv - set menu_auto_hide=1
    sudo grub2-mkconfig -o /etc/grub2.cfg

Если в дуалбуте установлена ОС Microsoft Windows, но всё равно требуется скрыть меню Grub 2, то вместо ``menu_auto_hide=1`` следует применять ``menu_auto_hide=2``.

Отмена изменений и повторная активацию меню на UEFI конфигурациях:

.. code-block:: text

    sudo grub2-editenv - unset menu_auto_hide
    sudo grub2-mkconfig -o /etc/grub2-efi.cfg

Отмена изменений и повторная активацию меню на legacy конфигурациях:

.. code-block:: text

    sudo grub2-editenv - unset menu_auto_hide
    sudo grub2-mkconfig -o /etc/grub2.cfg

Получить доступ к элементам скрытого меню можно посредством зажатия клавиши **Shift** или **F8** во время начальной загрузки системы.

.. index:: grub, bootloader, uefi, efi
.. _grub2-restore:

После установки Windows был затёрт UEFI загрузчик Fedora. Как его восстановить?
====================================================================================

Во время своей установки ОС Microsoft Windows всегда осуществляет форматирование служебного ESP раздела диска, поэтому придётся вручную восстановить загрузчик.

Выполним вход в :ref:`chroot установленной системы <chroot>`.

Выполним переустановку загрузчиков Grub2 и shim:

.. code-block:: text

    dnf reinstall grub2\* shim

:ref:`Пересоберём <grub-rebuild>` конфиг Grub2:

.. code-block:: text

    grub2-mkconfig -o /boot/efi/EFI/fedora/grub.cfg

Завершим работу chroot окружения:

.. code-block:: text

    logout

.. index:: installation, sudo, root, password
.. _root-no-password:

При установке не предлагается установить пароль для суперпользователя. Это нормально?
========================================================================================

Да. Если при установке системы был создан :ref:`пользователь-администратор <admin-vs-user>`, то пароль для учётной записи суперпользователя (root) не устанавливается.

Для выполнения команд с привилегиями суперпользователя в настоящее время рекомендуется :ref:`использовать sudo <sudo-run>`.

Однако если по какой-то причине работающая учётная запись root необходима, можно её активировать, :ref:`установив пароль <root-password>`.

.. index:: installation, date
.. _installation-date:

Как определить точную дату установки ОС?
===========================================

Т.к. операционная система постоянно обновляется, точную дату установки ОС напрямую получить не представляется возможным. Можно лишь вывести дату последнего форматирования раздела диска, на котором установлена система:

.. code-block:: text

    sudo dumpe2fs /dev/sda1 | grep 'Filesystem created:'

Здесь **/dev/sda1** -- раздел диска с Fedora.

.. index:: installation, date, mode, uefi, legacy
.. _installation-mode:

Как определить в каком режиме была произведена установка системы?
====================================================================

Определим режим установки системы (:ref:`UEFI <uefi-boot>` или Legacy) посредством проверки наличия либо отсутствия каталога ``/sys/firmware/efi``:

.. code-block:: text

    test -d /sys/firmware/efi && echo EFI || echo Legacy

.. index:: installation, dual boot, windows
.. _dual-boot:

Как установить Fedora в dual-boot вместе с другой ОС?
=========================================================

Существует два способа: автоматический и ручной.

**Автоматический способ:**

Загрузим систему с :ref:`Fedora LiveUSB <usb-flash>`, выберем автоматической способ разбиения. Все действия будут выполнены автоматически с настройками по умолчанию.

**Ручной способ:**

Выполним следующие шаги в строго указанном порядке:

  1. загрузим систему с :ref:`Live образа <usb-flash>`;
  2. установим менеджер разделов **GParted** ``sudo dnf install gparted`` (потребуется доступ к Интернету; в XFCE и LXDE Live он уже присутствует внутри базового образа);
  3. запустим GParted, затем уменьшим раздел другой ОС так, чтобы на диске появилось свободное место достаточного объёма;
  4. создадим :ref:`новые разделы <fedora-partitions>` для Fedora;
  5. запустим установку в режиме ручного разбиения диска, затем укажем точки монтирования для созданных разделов;
  6. завершим установку и перезагрузимся в установленную ОС;
  7. в случае если другой ОС является Microsoft Windows, применим :ref:`следующие оптимизации <dual-boot-optimizations>`.

Загрузчик :ref:`Grub 2 <grub-loader>` автоматически обнаружит другие операционные системы на устройстве и добавит их в список загрузки.

.. index:: installation, fedora, minimal, netinstall
.. _minimal-installation:

Как произвести минимальную установку системы?
=================================================

Если требуется выполнить минимальную установку системы без дополнительного программного обеспечения, но с графической средой Gnome или KDE, выполним следующие шаги в строго указанном порядке:

  1. осуществим загрузку с :ref:`netinstall-образа <download>`;
  2. в списке доступных компонентов выберем "Минимальная система";
  3. завершим установку в штатном режиме;
  4. загрузимся в установленную систему;
  5. отключим установку :ref:`слабых зависимостей <dnf-weakdeps>`;
  6. установим графичекую среду: ``sudo dnf install gdm gnome-shell`` (для Gnome 3), либо ``sudo dnf install sddm plasma-workspace`` (KDE Plasma);
  7. активируем менеджер графического входа в систему: ``sudo systemctl enable gdm.service`` (для Gnome 3), либо ``sudo systemctl enable sddm.service`` (KDE Plasma);
  8. сделаем :ref:`графический вход <configure-runlevel>` в систему основным: ``sudo systemctl set-default graphical.target``;
  9. осуществим перезагрузку системы: ``sudo systemctl reboot``.

Минимально возможная установка успешно завершена.
