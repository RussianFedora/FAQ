.. Fedora-Faq-Ru (c) 2018, EasyCoding Team and contributors
.. 
.. Fedora-Faq-Ru is licensed under a
.. Creative Commons Attribution-ShareAlike 4.0 International License.
.. 
.. You should have received a copy of the license along with this
.. work. If not, see <https://creativecommons.org/licenses/by-sa/4.0/>.
.. _installation:

********************************************
Вопросы, связанные с установкой системы
********************************************

.. index:: flash, usb, live, installation, установка
.. _usb-flash:

Как мне создать загрузочную флешку?
==========================================

См. `здесь <https://www.easycoding.org/2017/07/12/sozdayom-fedora-liveusb.html>`__.

.. index:: package, select, пакет, выбор пактов
.. _package-selection:

Есть возможность самому выбрать пакеты для установки?
==========================================================

Да, при помощи netinstall образа, но лишь группами.

.. index:: installation, установка
.. _web-install:

Необходим ли доступ в Интернет при установке?
==========================================================

Только для netinstall образа. Все остальные устанавливаются «как есть», т.е. со стандартным набором пакетов.

.. index:: installation, установка, автоматизация
.. _automatic-install:

Могу ли я автоматизировать установку?
==========================================================

Да, посредством `Kickstart <https://pykickstart.readthedocs.io/en/latest/>`__.

.. index:: iso, образ, создание образа
.. _custom-iso:

Могу ли я создать свой собственный ISO образ?
==========================================================

Да. Собственный образ можно создать на базе Kickstart файлов. Более подобную информацию можно найти `здесь <https://fedoraproject.org/wiki/Livemedia-creator-_How_to_create_and_use_a_Live_CD>`__.

Готовые Kickstart проекты для изучения:

 * `Fedora <https://pagure.io/fedora-kickstarts>`__;
 * `RFRemix <https://github.com/RussianFedora/rfremix-kickstarts>`__.

.. index:: installation, установка, ARM
.. _fedora-arm:

Можно ли установить Fedora на устройство с ARM?
==========================================================

Да. Загрузки доступны `здесь <https://arm.fedoraproject.org/>`__.

.. index:: загрузка, boot, secure boot, безопасная загрузка
.. _secure-boot:

Поддерживается ли технология Secure Boot?
==========================================================

Да. Полностью.

.. index:: загрузка, boot, порядок загрузки
.. _uefi-reorder:

Возможно ли настроить порядок загрузки в UEFI Boot из Fedora?
=================================================================

Да, при помощи утилиты **efibootmgr**. Вывод текущего списка загрузки UEFI Boot:

.. code-block:: bash

    sudo efibootmgr -v

Изменение порядка:

.. code-block:: bash

    sudo efibootmgr -o 0000,0002,0003,0001

Здесь **0000** и прочие строки из предыдущего вывода утилиты. Изменения вступают в силу немедленно.

.. index:: moving installed system, перенос установленной системы
.. _moving-system:

Могу я переместить Fedora на другой диск?
============================================

Да. Алгоритм такой:

 1. загрузка с LiveUSB;
 2. создание разделов для новой установки Fedora посредством GParted или любой другой утилиты разбиения дисков;
 3. монтирование старых и новых разделов;
 4. копирование всех файлов и каталогов со старого накопителя на новый с сохранением прав доступа посредством **sudo cp** или **sudo rsync**;
 5. редактирование файла **/etc/fstab** нового накопителя так, чтобы в нём были указаны UUID новых разделов;
 6. создание в корневом каталоге нового накопителя файла **/.autorelabel** для автоматической установки контекста безопасности SELinux;
 7. установка загрузчика (если необходимо).

.. index:: swap, подкачка
.. _swap-info:

У меня 8 ГБ памяти. Нужен ли мне раздел подкачки?
=====================================================

Для большинства сценариев использования на рабочих станциях 8 ГБ оперативной памяти будет вполне достаточно, поэтому раздел подкачки можно не создавать.

Внимание! При отключении раздела подкачки перестанет работать функция suspend to disk (гибернация).

.. index:: swap, подкачка
.. _mem-outage:

Что будет если при отсутствующем разделе подкачки закончится память?
========================================================================

При критическом недостатке оперативной памяти будет задействован механизм ядра OOM Killer, который начнёт завершать самые ресурсоёмкие процессы. Работа системы при этом не будет нарушена.

.. index:: swap, подкачка
.. _swap-limits:

Сколько нужно подкачки для работы гибернации?
=================================================

Для нормальной работы режима suspend to disk размер подкачки должен быть больше, либо равен объёму установленной в ПК или ноутбуке оперативной памяти.

.. index:: swap, подкачка
.. _swap-partitions:

Что быстрее: раздел подкачки или файл подкачки?
===================================================

Раздел подкачки, т.к. отсутствуют ограничения, накладываемые используемой файловой системой.

.. index:: swap, подкачка
.. _swappiness:

Можно ли сделать так, чтобы подкачка использовалась лишь при исчерпании ОП?
================================================================================

Да, это возможно. Необходимо выполнить:

.. code-block:: bash

    sudo sysctl -w vm.swappiness=10

Изменения вступят в силу немедленно и сохранятся до перезагрузки системы. Если нужно сделать это постоянным, см. :ref:`данное руководство <sysctl-permanent>`.

.. index:: speed-up, ускорение запуска
.. _speedup-main:

Как ускорить запуск системы?
================================

Приобрести в компьютер или ноутбук SSD накопитель и установить операционную систему на него. Это даст колоссальный прирост к скорости запуска.

.. index:: speed-up, ускорение запуска
.. _speedup-home:

Можно ли не переносить на SSD домашние каталоги пользователей?
=================================================================

Можно, но мы не рекомендуем это ибо в таком случае прирост к скорости работы системы будет далеко не таким большим, как мог бы быть. Поэтому мы настоятельно рекомендуем размещать на SSD накопителе как корневой каталог, так и пользовательские.

.. index:: ssd, tuning, настройка под ssd, trim
.. _ssd-tuning:

Нужно ли как-то настраивать Fedora для работы с SSD?
========================================================

Актуальные версии не требуют особой настройки если были сразу установлены на SSD. Достаточно лишь убедиться, что TRIM таймер активен:

.. code-block:: bash

    systemctl status fstrim.timer

Если это не так, нужно активировать его:

.. code-block:: bash

    sudo systemctl enable fstrim.timer

Процедура TRIM для всех установленных твердотельных накопителей будет выполняться автоматически по расписанию один раз в неделю во время простоя системы.

.. index:: ssd, tuning, настройка под ssd, trim, lvm
.. _ssd-trim:

Возможно ли в Fedora включить TRIM в реальном времени?
==========================================================

Да, это возможно. При использовании классической схемы с обычными разделами необходимо добавить опцию монтирования **discard** для каждого раздела на SSD в **/etc/fstab**.

При использовании LVM, следует открыть файл **/etc/lvm/lvm.conf** в текстовом редакторе и прописать:

.. code-block:: text

    issue_discards = 1

При использовании зашифрованных LUKS томов следует в файле **/etc/crypttab** добавить опцию **allow-discards** для каждого тома.

Однако следует помнить, что на некоторых накопителях реалтаймовый TRIM может вызвать сбой в работе контроллера и привести к потере всех данных. Именно поэтому он по умолчанию и не применяется.

Все изменения вступят в силу при следующей загрузке системы.

.. index:: fonts, настройка шрифтов, сглаживание шрифтов
.. _fonts-cleartype:

Как улучшить отображение шрифтов в Fedora?
=============================================

В актуальных релизах Fedora пакет freetype уже собран с поддержкой субпиксельного сглаживания, поэтому чтобы получить качественный рендеринг шрифтов, необходимо лишь разрешить использование LCD фильтров, создав символическую ссылку на файл **11-lcdfilter-default.conf** в каталоге **/etc/fonts/conf.d**:

.. code-block:: bash

    sudo ln -s /usr/share/fontconfig/conf.avail/11-lcdfilter-default.conf /etc/fonts/conf.d/

Для вступления изменений в силу необходимо повторно войти в систему, либо перезагрузить компьютер.

.. index:: console, framebuffer, настройка шрифтов
.. _fonts-console:

В консолях фреймбуфера отображаются кракозябры. Как это починить?
=====================================================================

*Способ 1*. Зададим следующий параметр ядра:

.. code-block:: text

    vconsole.font=latarcyrheb-sun16

*Способ 2*. Установим пакет шрифтов Terminus:

.. code-block:: bash

    sudo dnf install terminus-fonts-console

Теперь откроем файл **/etc/vconsole.conf** в текстовом редакторе и активируем их использование:

.. code-block:: text

    FONT=ter-v16n

.. index:: file system, convert, файловая система
.. _fs-convert:

Можно ли без потерь данных преобразовать одну файловую систему в другую?
==============================================================================

Нет, конвертирование ФС без потери данных не представляется возможным, поэтому для выполнения данной процедуры необходим другой раздел диска подходящего размера с поддержкой прав доступа Unix. Алгоритм следующий:

 1. копирование всех данных на другой раздел с сохранением прав доступа посредством cp или rsync;
 2. форматирование старого раздела с необходимой файловой системой;
 3. возвращение данных на прежнее место;
 4. сброс контекста SELinux.

.. index:: uefi, boot, esp
.. _uefi-boot:

Установить Fedora в UEFI режиме?
====================================

Загрузка LiveUSB образа должна производиться исключительно в UEFI режиме. На большинстве материнских плат в меню вариантов загрузки требуется выбрать режим *UEFI External Drive* или *UEFI USB HDD*.

Схемой разбиения диска, на который будет установлен дистрибутив, должна быть **GPT**. Проверить можно посредством выполнения **fdisk**:

.. code-block:: bash

    sudo fdisk -l

Если используется классический **MBR** (**msdos**), необходимо запустить утилиту GParted, выбрать диск из списка, затем в меню **Устройство** пункт **Создать таблицу разделов** - **GPT** и запустить процесс кнопкой **Применить изменения**. Все данные на диске будут уничтожены.

Теперь можно приступать к установке. Автоматическое разбиение в Anaconda произведёт все действия самостоятельно.

.. index:: drive, partitions, разбиение диска
.. _fedora-partitions:

Как лучше разбить диск самостоятельно?
=========================================

Если по какой-то причине не хочется доверять автоматическому разбиению, мы рекомендуем следующую конфигурацию (порядок важен):

========    =================    ==============    ==================    ======================================================
Порядок     Файловая система     Размер раздела    Точка монтирования    Описание
========    =================    ==============    ==================    ======================================================
1           efi (vfat)           200 МБ            /boot/efi             Служебный ESP (UEFI) раздел.
2           ext4                 1 ГБ              /boot                 Раздел для хранения ядер и initrd.
3           ext4 или xfs         20 ГБ             /                     Корневой раздел для системы и приложений.
4           ext4 или xfs         всё - swap        /home                 Раздел для хранения пользовательских файлов.
5           swapfs               = RAM             swap                  Раздел подкачки (:ref:`если необходим <swap-info>`).
========    =================    ==============    ==================    ======================================================

Здесь **RAM** - объём установленной оперативной памяти.

.. index:: grub, boot, menu
.. _grub-hide:

Как полностью скрыть меню Grub?
====================================

Скрытие меню загрузки на UEFI конфигурациях:

.. code-block:: bash

    sudo grub2-editenv - set menu_auto_hide=1
    sudo grub2-mkconfig -o /etc/grub2-efi.cfg

Скрытие меню загрузки на legacy конфигурациях:

.. code-block:: bash

    sudo grub2-editenv - set menu_auto_hide=1
    sudo grub2-mkconfig -o /etc/grub2.cfg

Если в дуалбуте установлена ОС Microsoft Windows, но всё равно требуется скрыть меню Grub 2, то вместо **menu_auto_hide=1** следует применять **menu_auto_hide=2**.

Отмена изменений и повторная активацию меню на UEFI конфигурациях:

.. code-block:: bash

    sudo grub2-editenv - unset menu_auto_hide
    sudo grub2-mkconfig -o /etc/grub2-efi.cfg

Отмена изменений и повторная активацию меню на legacy конфигурациях:

.. code-block:: bash

    sudo grub2-editenv - unset menu_auto_hide
    sudo grub2-mkconfig -o /etc/grub2.cfg

Получить доступ к элементам скрытого меню можно посредством зажатия клавиши **Shift** или **F8** во время начальной загрузки системы.
